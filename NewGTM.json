{
  "name": "NewGTM",
  "nodes": [
    {
      "parameters": {
        "table": "jobs",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2,
      "position": [
        -4688,
        6272
      ],
      "id": "158023a9-ffab-4018-ad42-5ca8ee8f82ff",
      "name": "MySQL Insert",
      "credentials": {
        "mySql": {
          "id": "Mmz0SsGmSZ76dUMn",
          "name": "MySQL account 2"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -5904,
        6240
      ],
      "id": "5c35883d-4f54-47ee-90e6-2b16d157903d",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "path": "jobs-ui",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -4688,
        5648
      ],
      "id": "6c486114-0e58-4591-83f2-8351f87f5a07",
      "name": "Jobs UI (GET)",
      "webhookId": "7ca4db1d-6e14-4652-8a72-bcbbebbc6aa6"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM jobs ORDER BY job_posted_at_datetime_utc DESC LIMIT 50",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2,
      "position": [
        -4112,
        5648
      ],
      "id": "9483292b-ea5c-4b7b-96f1-8828f933517b",
      "name": "Fetch Jobs for UI (MySQL)",
      "credentials": {
        "mySql": {
          "id": "Mmz0SsGmSZ76dUMn",
          "name": "MySQL account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const html = `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\" />\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n  <title>Jobs Selection</title>\n  <style>\n    :root {\n      --bg: #0f1220;\n      --card: #171a2b;\n      --muted: #9aa4bf;\n      --text: #eef1ff;\n      --accent: #f4b266;\n      --accent-2: #6fc3df;\n      --border: #2a2f45;\n      --chip: #1f2438;\n      --shadow: 0 12px 30px rgba(0,0,0,0.35);\n    }\n    * { box-sizing: border-box; }\n    body {\n      margin: 0;\n      font-family: \"Space Grotesk\", \"Satoshi\", \"Segoe UI\", sans-serif;\n      background: radial-gradient(1200px 600px at 10% -20%, #243b55 0%, transparent 60%),\n                  radial-gradient(800px 500px at 90% -10%, #3b2f2f 0%, transparent 60%),\n                  var(--bg);\n      color: var(--text);\n    }\n    header {\n      padding: 28px 28px 12px;\n      display: flex;\n      align-items: flex-end;\n      justify-content: space-between;\n      gap: 16px;\n    }\n    h1 {\n      margin: 0;\n      font-size: 28px;\n      letter-spacing: 0.2px;\n    }\n    .sub {\n      color: var(--muted);\n      font-size: 14px;\n      margin-top: 6px;\n    }\n    .stats {\n      display: flex;\n      gap: 12px;\n      flex-wrap: wrap;\n    }\n    .chip {\n      background: var(--chip);\n      border: 1px solid var(--border);\n      border-radius: 999px;\n      padding: 6px 12px;\n      font-size: 12px;\n      color: var(--muted);\n    }\n    .container {\n      padding: 0 24px 32px;\n      display: grid;\n      grid-template-columns: 1fr;\n      gap: 16px;\n    }\n    .panel {\n      background: var(--card);\n      border: 1px solid var(--border);\n      border-radius: 14px;\n      box-shadow: var(--shadow);\n      padding: 16px;\n    }\n    .filters {\n      display: grid;\n      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\n      gap: 12px;\n    }\n    input, select, button, textarea {\n      font: inherit;\n      color: var(--text);\n    }\n    input, select {\n      background: #111427;\n      border: 1px solid var(--border);\n      border-radius: 10px;\n      padding: 10px 12px;\n      width: 100%;\n      outline: none;\n    }\n    button {\n      background: linear-gradient(135deg, var(--accent), #f7d199);\n      border: none;\n      color: #1b1b1b;\n      padding: 10px 14px;\n      border-radius: 10px;\n      cursor: pointer;\n      font-weight: 600;\n    }\n    button.secondary {\n      background: transparent;\n      border: 1px solid var(--border);\n      color: var(--text);\n    }\n    .table-wrap {\n      overflow: auto;\n      border-radius: 12px;\n      border: 1px solid var(--border);\n      background: #101424;\n    }\n    table {\n      width: 100%;\n      border-collapse: collapse;\n      min-width: 720px;\n    }\n    thead th {\n      position: sticky;\n      top: 0;\n      background: #12162b;\n      text-align: left;\n      font-size: 12px;\n      text-transform: uppercase;\n      letter-spacing: 0.08em;\n      padding: 12px;\n      border-bottom: 1px solid var(--border);\n    }\n    tbody td {\n      padding: 12px;\n      border-bottom: 1px solid var(--border);\n      font-size: 14px;\n    }\n    tbody tr:hover {\n      background: rgba(255,255,255,0.03);\n    }\n    .row-title {\n      font-weight: 600;\n      margin-bottom: 4px;\n    }\n    .row-meta {\n      color: var(--muted);\n      font-size: 12px;\n    }\n    .badge {\n      display: inline-block;\n      padding: 4px 8px;\n      border-radius: 999px;\n      background: rgba(111,195,223,0.15);\n      color: var(--accent-2);\n      font-size: 11px;\n      border: 1px solid rgba(111,195,223,0.3);\n    }\n    .footer-bar {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      gap: 12px;\n      flex-wrap: wrap;\n    }\n    .selected-list {\n      max-height: 120px;\n      overflow: auto;\n      border: 1px dashed var(--border);\n      padding: 8px;\n      border-radius: 10px;\n      background: #0f1220;\n      font-size: 12px;\n      color: var(--muted);\n    }\n    .action-row {\n      display: flex;\n      gap: 10px;\n      flex-wrap: wrap;\n      align-items: center;\n    }\n    .pagination {\n      display: flex;\n      gap: 8px;\n      align-items: center;\n      color: var(--muted);\n      font-size: 13px;\n    }\n    .empty {\n      text-align: center;\n      padding: 40px;\n      color: var(--muted);\n    }\n    @media (max-width: 780px) {\n      header {\n        flex-direction: column;\n        align-items: flex-start;\n      }\n    }\n  </style>\n</head>\n<body>\n  <header>\n    <div>\n      <h1>Job Selection Console</h1>\n      <div class=\"sub\">Pick jobs to advance in the workflow. Latest records are loaded from Database.</div>\n    </div>\n    <div class=\"stats\">\n      <div class=\"chip\" id=\"total-count\">0 jobs</div>\n      <div class=\"chip\" id=\"filtered-count\">0 shown</div>\n      <div class=\"chip\" id=\"selected-count\">0 selected</div>\n    </div>\n  </header>\n\n  <div class=\"container\">\n    <div class=\"panel\">\n      <div class=\"filters\">\n        <input id=\"search\" type=\"text\" placeholder=\"Search title, company, location...\" />\n        <select id=\"filter-remote\">\n          <option value=\"\">Remote + On-site</option>\n          <option value=\"remote\">Remote only</option>\n          <option value=\"onsite\">On-site only</option>\n        </select>\n        <input id=\"filter-type\" type=\"text\" placeholder=\"Employment type (e.g., Full-time)\" />\n        <select id=\"sort\">\n          <option value=\"recent\">Sort by recent</option>\n          <option value=\"company\">Sort by company</option>\n          <option value=\"title\">Sort by title</option>\n        </select>\n      </div>\n    </div>\n\n    <div class=\"panel\">\n      <div class=\"table-wrap\">\n        <table>\n          <thead>\n            <tr>\n              <th style=\"width: 48px;\"><input id=\"toggle-all\" type=\"checkbox\" /></th>\n              <th>Role</th>\n              <th>Company</th>\n              <th>Location</th>\n              <th>Type</th>\n              <th>Remote</th>\n              <th>Posted</th>\n              <th>Link</th>\n            </tr>\n          </thead>\n          <tbody id=\"table-body\"></tbody>\n        </table>\n        <div id=\"empty\" class=\"empty\" style=\"display:none;\">No jobs match the current filters.</div>\n      </div>\n    </div>\n\n    <div class=\"panel\">\n      <div class=\"footer-bar\">\n        <div class=\"pagination\">\n          <button class=\"secondary\" id=\"prev-page\">Prev</button>\n          <span id=\"page-status\">Page 1</span>\n          <button class=\"secondary\" id=\"next-page\">Next</button>\n        </div>\n        <div class=\"action-row\">\n          <button class=\"secondary\" id=\"clear-selection\">Clear selection</button>\n          <button id=\"submit-selection\">Push selected to flow</button>\n        </div>\n      </div>\n      <div style=\"margin-top: 12px;\">\n        <div class=\"sub\" style=\"margin-bottom: 6px;\">Selected jobs</div>\n        <div id=\"selected-list\" class=\"selected-list\"></div>\n      </div>\n    </div>\n  </div>\n\n  <script>\n    const state = {\n      page: 1,\n      perPage: 12,\n      search: '',\n      remote: '',\n      type: '',\n      sort: 'recent',\n      selected: new Set(),\n      jobs: [],\n      total: 0,\n      loading: false,\n    };\n\n    const el = (id) => document.getElementById(id);\n    const tableBody = el('table-body');\n    const empty = el('empty');\n    const totalCount = el('total-count');\n    const filteredCount = el('filtered-count');\n    const selectedCount = el('selected-count');\n    const selectedList = el('selected-list');\n\n    const formatDate = (value) => {\n      if (!value) return 'N/A';\n      const d = new Date(value);\n      if (Number.isNaN(d.getTime())) return value;\n      return d.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });\n    };\n\n    const getBase = () => {\n      const useTest = window.location.pathname.includes('/webhook-test/');\n      return window.location.origin + (useTest ? '/webhook-test/' : '/webhook/');\n    };\n\n    const loadData = async () => {\n      state.loading = true;\n      const params = new URLSearchParams({\n        q: state.search || '',\n        remote: state.remote || '',\n        type: state.type || '',\n        sort: state.sort || 'recent',\n        page: String(state.page),\n        perPage: String(state.perPage),\n      });\n\n      const url = \\`\\${getBase()}jobs-ui-data?\\${params}\\`;\n      try {\n        const res = await fetch(url);\n        if (!res.ok) throw new Error(\\`HTTP \\${res.status}\\`);\n        const payload = await res.json();\n        state.jobs = Array.isArray(payload.items) ? payload.items : [];\n        state.total = Number(payload.total || payload.totalCount || state.jobs.length || 0);\n      } catch (err) {\n        console.error(err);\n        state.jobs = [];\n        state.total = 0;\n      } finally {\n        state.loading = false;\n        render();\n      }\n    };\n\n    const render = () => {\n      const totalPages = Math.max(1, Math.ceil(state.total / state.perPage) || 1);\n      state.page = Math.min(state.page, totalPages);\n\n      totalCount.textContent = \\`\\${state.total} jobs\\`;\n      filteredCount.textContent = \\`\\${state.jobs.length} shown\\`;\n      selectedCount.textContent = \\`\\${state.selected.size} selected\\`;\n\n      tableBody.innerHTML = '';\n      if (!state.jobs.length) {\n        empty.style.display = 'block';\n      } else {\n        empty.style.display = 'none';\n      }\n\n      state.jobs.forEach((job) => {\n        const tr = document.createElement('tr');\n        const checked = state.selected.has(job.id);\n        tr.innerHTML = \\`\n          <td><input type=\"checkbox\" data-id=\"\\${job.id}\" \\${checked ? 'checked' : ''} /></td>\n          <td><div class=\"row-title\">\\${job.title}</div><div class=\"row-meta\">\\${job.id}</div></td>\n          <td>\\${job.company}</td>\n          <td>\\${job.location}</td>\n          <td>\\${job.employmentType || 'N/A'}</td>\n          <td>\\${job.remote ? '<span class=\"badge\">Remote</span>' : 'On-site'}</td>\n          <td>\\${formatDate(job.postedAt || job.createdAt)}</td>\n          <td>\\${job.url ? \\`<a href=\"\\${job.url}\" target=\"_blank\" rel=\"noopener\" style=\"color: var(--accent-2);\">Open</a>\\` : 'N/A'}</td>\n        \\`;\n        tableBody.appendChild(tr);\n      });\n\n      el('page-status').textContent = \\`Page \\${state.page} of \\${totalPages}\\`;\n      renderSelectedList();\n    };\n\n    const renderSelectedList = () => {\n      if (!state.selected.size) {\n        selectedList.textContent = 'No jobs selected yet.';\n        return;\n      }\n      const selectedJobs = state.jobs.filter(j => state.selected.has(j.id));\n      if (!selectedJobs.length) {\n        selectedList.textContent = \\`\\${state.selected.size} jobs selected across pages.\\`;\n        return;\n      }\n      selectedList.innerHTML = selectedJobs.map(j => \\`\\${j.title} â€” \\${j.company}\\`).join('<br />');\n    };\n\n    const debounce = (fn, delay) => {\n      let t;\n      return (...args) => {\n        clearTimeout(t);\n        t = setTimeout(() => fn(...args), delay);\n      };\n    };\n\n    tableBody.addEventListener('change', (event) => {\n      const target = event.target;\n      if (target && target.matches('input[type=\"checkbox\"][data-id]')) {\n        const id = target.getAttribute('data-id');\n        if (target.checked) state.selected.add(id);\n        else state.selected.delete(id);\n        selectedCount.textContent = \\`\\${state.selected.size} selected\\`;\n        renderSelectedList();\n      }\n    });\n\n    el('toggle-all').addEventListener('change', (event) => {\n      const checked = event.target.checked;\n      state.jobs.forEach((job) => {\n        if (checked) state.selected.add(job.id);\n        else state.selected.delete(job.id);\n      });\n      render();\n    });\n\n    el('search').addEventListener('input', debounce((e) => {\n      state.search = e.target.value.trim();\n      state.page = 1;\n      loadData();\n    }, 300));\n\n    el('filter-remote').addEventListener('change', (e) => {\n      state.remote = e.target.value;\n      state.page = 1;\n      loadData();\n    });\n\n    el('filter-type').addEventListener('input', debounce((e) => {\n      state.type = e.target.value.trim();\n      state.page = 1;\n      loadData();\n    }, 300));\n\n    el('sort').addEventListener('change', (e) => {\n      state.sort = e.target.value;\n      state.page = 1;\n      loadData();\n    });\n\n    el('prev-page').addEventListener('click', () => {\n      state.page = Math.max(1, state.page - 1);\n      loadData();\n    });\n\n    el('next-page').addEventListener('click', () => {\n      const maxPage = Math.max(1, Math.ceil(state.total / state.perPage));\n      state.page = Math.min(maxPage, state.page + 1);\n      loadData();\n    });\n\n    el('clear-selection').addEventListener('click', () => {\n      state.selected.clear();\n      render();\n    });\n\n    el('submit-selection').addEventListener('click', async () => {\n      if (!state.selected.size) {\n        alert('Select at least one job to continue.');\n        return;\n      }\n      const base = getBase();\n      const url = base + 'jobs-ui-submit';\n      const payload = { selectedJobIds: Array.from(state.selected) };\n\n      try {\n        const res = await fetch(url, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload),\n        });\n        if (!res.ok) throw new Error(\\`HTTP \\${res.status}\\`);\n        const html = await res.text();\n        document.open();\n        document.write(html);\n        document.close();\n      } catch (err) {\n        alert('Submit failed. Check n8n logs and try again.');\n        console.error(err);\n      }\n    });\n\n    loadData();\n  </script>\n</body>\n</html>`;\n\nreturn [{ json: { html } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4384,
        5872
      ],
      "id": "77cf7358-a904-4a09-8ceb-35e80d69ee8f",
      "name": "Build Jobs UI HTML (Server)"
    },
    {
      "parameters": {
        "path": "jobs-ui-data",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -4688,
        5856
      ],
      "id": "3104af72-9d31-4149-83a0-53a3e79788b0",
      "name": "Jobs UI Data (GET)",
      "webhookId": "739b31a2-c257-4254-bf0a-4dd3872095e6"
    },
    {
      "parameters": {
        "jsCode": "const query = $json.query || $json || {};\nconst search = String(query.q || '').trim();\nconst sort = String(query.sort || 'recent').trim();\nconst page = Math.max(1, parseInt(query.page || '1', 10) || 1);\nconst perPage = Math.min(50, Math.max(5, parseInt(query.perPage || '12', 10) || 12));\nconst offset = (page - 1) * perPage;\n\nlet where = '1=1';\nif (search) {\n  const safe = search.replace(/'/g, \"\\\\'\");\n  where += ` AND (job_title LIKE '%${safe}%' OR employer_name LIKE '%${safe}%' OR job_location LIKE '%${safe}%')`;\n}\nif (query.remote === 'remote') where += \" AND job_is_remote = 1\";\nif (query.remote === 'onsite') where += \" AND job_is_remote = 0\";\nif (query.type) {\n  const safeType = query.type.replace(/'/g, \"\\\\'\");\n  where += ` AND job_employment_type LIKE '%${safeType}%'`;\n}\n\nlet orderBy = 'job_posted_at_datetime_utc DESC';\nif (sort === 'company') orderBy = 'employer_name ASC';\nif (sort === 'title') orderBy = 'job_title ASC';\n\nconst sql = `SELECT * FROM jobs WHERE ${where} ORDER BY ${orderBy} LIMIT ${perPage} OFFSET ${offset}`;\nreturn [{ json: { query: sql, page, perPage } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4272,
        6144
      ],
      "id": "67c83e74-ffc8-4dff-9558-03a509cdb641",
      "name": "Build Jobs Data Query"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "={{$json.query}}",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2,
      "position": [
        -4032,
        6144
      ],
      "id": "da2b4a3b-e4d3-4bc6-8f98-faf218e906ba",
      "name": "Fetch Jobs Data (MySQL)",
      "credentials": {
        "mySql": {
          "id": "Mmz0SsGmSZ76dUMn",
          "name": "MySQL account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Get all items from the MySQL node\nconst response = $input.all().map(item => item.json);\nconst total = response.length;\n\nconst items = response.map((j) => ({\n  id: String(j.job_id || j.id || ''),\n  title: j.job_title || 'Untitled role',\n  company: j.employer_name || 'Unknown company',\n  location: j.job_location || [j.job_city, j.job_state].filter(Boolean).join(', ') || 'Location N/A',\n  country: j.job_country || '',\n  employmentType: j.job_employment_type || (Array.isArray(j.job_employment_types) ? j.job_employment_types.join(', ') : ''),\n  remote: Boolean(j.job_is_remote),\n  postedAt: j.job_posted_at_datetime_utc || j.job_posted_at || '',\n  url: j.job_apply_link || j.job_google_link || '',\n  createdAt: j.created_at || ''\n}));\n\nconst meta = $items('Build Jobs Data Query')[0]?.json || {};\nreturn [{ json: { items, total, page: meta.page || 1, perPage: meta.perPage || 12 } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3792,
        6144
      ],
      "id": "059ce373-a486-4fb5-ac6a-cffb4209599f",
      "name": "Build Jobs Data Response"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{JSON.stringify($json)}}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json; charset=UTF-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        -3552,
        6144
      ],
      "id": "3719b74d-f6a3-423f-9513-5a5b47698f97",
      "name": "Jobs Data Response"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{$json.html}}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=UTF-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        -3792,
        5936
      ],
      "id": "c32e7b01-ec5c-41b5-ac62-bdd38109ed32",
      "name": "Jobs UI Response"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "jobs-ui-submit",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        -4480,
        6592
      ],
      "id": "a7125c17-c458-45b5-827a-6d7655016e29",
      "name": "Jobs UI Submit (POST)",
      "webhookId": "b229f389-b6e5-483d-987b-c21047af9039"
    },
    {
      "parameters": {
        "jsCode": "const payload = $json.body || $json;\nlet selectedIds = payload.selectedJobIds || payload.selectedIds || payload.ids || [];\nif (typeof selectedIds === 'string') {\n  try { selectedIds = JSON.parse(selectedIds); } catch (e) { selectedIds = selectedIds.split(','); }\n}\nconst selectedList = Array.isArray(selectedIds) ? selectedIds : [selectedIds];\nconst ids = selectedList.map(id => `'${String(id).replace(/'/g, \"\\\\'\")}'`).join(',');\n\nif (!ids) return [{ json: { query: \"SELECT * FROM jobs WHERE 1=0\" } }];\nreturn [{ json: { query: `SELECT * FROM jobs WHERE job_id IN (${ids})` } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4272,
        6320
      ],
      "id": "8ff90230-ff33-493b-a37a-5fe94f8afe3e",
      "name": "Build Submit Query"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "={{$json.query}}",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2,
      "position": [
        -4032,
        6320
      ],
      "id": "ee149bb4-7cb0-409d-a661-528e35615843",
      "name": "Fetch Selected Jobs (MySQL)",
      "credentials": {
        "mySql": {
          "id": "Mmz0SsGmSZ76dUMn",
          "name": "MySQL account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const rows = Array.isArray($json) ? $json : (Array.isArray($json.body) ? $json.body : []);\nreturn rows.map((row) => ({ json: row }));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3792,
        6320
      ],
      "id": "7f3e9a92-e428-4ff8-a481-32fff01cacf6",
      "name": "Filter Selected Jobs (Submit)"
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "={{'<html><head><meta charset=\"utf-8\"><meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"><title>Selection Received</title><style>body{font-family:Segoe UI, sans-serif;background:#0f1220;color:#eef1ff;display:flex;align-items:center;justify-content:center;height:100vh;margin:0;} .card{background:#171a2b;border:1px solid #2a2f45;border-radius:14px;padding:24px;max-width:520px;text-align:center;} a{color:#6fc3df;text-decoration:none;}</style></head><body><div class=\"card\"><h2>Selection received</h2><p>Your jobs have been sent to the workflow.</p><p>You can close this tab or <a href=\"/webhook/jobs-ui\">go back</a>.</p></div></body></html>'}}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "text/html; charset=UTF-8"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        -3520,
        6464
      ],
      "id": "f0f6bd20-abc6-46a2-9834-28ba35cf3982",
      "name": "Selection Response"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 9 * * 1-5"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -5904,
        6496
      ],
      "id": "04635b43-8a03-4297-bb8c-964e21eb5082",
      "name": "Daily Schedule (9AM EST)2"
    },
    {
      "parameters": {
        "url": "https://jsearch.p.rapidapi.com/search",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "query",
              "value": "Clay & GTM Engineer & Go-to-market jobs in UK"
            },
            {
              "name": "page",
              "value": "1"
            },
            {
              "name": "num_pages",
              "value": "1"
            },
            {
              "name": "country",
              "value": "gb"
            },
            {
              "name": "date_posted",
              "value": "week"
            },
            {
              "name": "employment_types",
              "value": "FULLTIME, CONTRACTOR, PARTTIME, INTERN"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-rapidapi-host",
              "value": "jsearch.p.rapidapi.com"
            },
            {
              "name": "x-rapidapi-key",
              "value": "4cc7a21f4fmsh7416f2f11d8633bp16232bjsn565d34b1a86c"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -5536,
        6336
      ],
      "id": "51ae8fa0-24c1-4d04-8133-3c0eb54ae663",
      "name": "Job Scraper2",
      "retryOnFail": true,
      "waitBetweenTries": 5000,
      "maxTries": 3,
      "onError": "continueErrorOutput",
      "notes": "âš ï¸ SECURITY: Move x-rapidapi-key to n8n Credentials!\n\nRapidAPI JSearch - Fetches GTM/Clay jobs from the past week."
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -5120,
        6464
      ],
      "id": "9ef1e795-6b65-470c-9e26-6e0821bec7a0",
      "name": "Split Out2"
    },
    {
      "parameters": {
        "jsCode": "return $input.all().map(item => {\n  const j = item.json;\n  return {\n    json: {\n      job_id: j.job_id,\n      job_title: j.job_title,\n      employer_name: j.employer_name,\n      job_location: j.job_location,\n      job_country: j.job_country,\n      job_employment_type: j.job_employment_type,\n      job_is_remote: j.job_is_remote ? 1 : 0,\n      job_posted_at_datetime_utc: j.job_posted_at_datetime_utc ? new Date(j.job_posted_at_datetime_utc).toISOString().slice(0, 19).replace('T', ' ') : null,\n      job_apply_link: j.job_apply_link,\n      job_google_link: j.job_google_link\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -4912,
        6464
      ],
      "id": "931d89b1-4da9-4693-b032-9883c1e22140",
      "name": "Prepare Job Data"
    },
    {
      "parameters": {
        "sendTo": "sohom@insightstap.com",
        "subject": "=ðŸš¨ GTM Workflow Error: {{ $json.error.code || 429 }} at Jsearch API from RapidAPi",
        "emailType": "text",
        "message": "=Hello, \n\nThe GTM Research workflow has encountered an error.\n\n--- ERROR SUMMARY ---\nNode: JobSearch\nError Type: {{ $json.error.code || \"Unknown Error\" }} \nStatus Code: {{ $json.status || $json.error?.httpCode || 429 }}\n\n--- DETAILED MESSAGE ---\n{{ $json.message || $json.error?.message || \"No message provided.\" }}\n\n--- TECHNICAL DETAILS ---\n{{ $json.stack ? $json.stack.split('\\n')[0] : \"Check execution logs for stack trace.\" }}\n\n--- ACTION REQUIRED ---\nFix the issue and continue execution.",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        -5136,
        6160
      ],
      "id": "0d66310b-4398-4700-a6e7-2e2158efe607",
      "name": "Error Alert - Job Scraper",
      "webhookId": "2ad56aa9-1932-4aa6-8bad-cc3305fd7db8",
      "credentials": {
        "gmailOAuth2": {
          "id": "v1wrpbcHjokyVyuA",
          "name": "Gmail account"
        }
      }
    }
  ],
  "pinData": {
    "Prepare Job Data": [
      {
        "json": {
          "job_id": "wTbpSo_At_d0wgYGAAAAAA==",
          "job_title": "GTME (Sales) Enablement",
          "employer_name": "Clay Labs",
          "job_location": "New York, NY",
          "job_country": "US",
          "job_employment_type": "Full-time",
          "job_is_remote": 0,
          "job_posted_at_datetime_utc": "2026-01-26 09:00:00",
          "job_apply_link": "https://www.ziprecruiter.com/c/Clay-Labs/Job/GTME-(Sales)-Enablement/-in-New-York,NY?jid=02e519a4d514bda6&utm_campaign=google_jobs_apply&utm_source=google_jobs_apply&utm_medium=organic",
          "job_google_link": "https://www.google.com/search?q=jobs&gl=us&hl=en&udm=8#vhid=vt%3D20/docid%3DwTbpSo_At_d0wgYGAAAAAA%3D%3D&vssid=jobs-detail-viewer"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "job_id": "R830A5nxXHHXtE6lAAAAAA==",
          "job_title": "GTM Engineer (GTM Ops)",
          "employer_name": "Clay Labs",
          "job_location": "New York, NY",
          "job_country": "US",
          "job_employment_type": "Full-time",
          "job_is_remote": 0,
          "job_posted_at_datetime_utc": "2026-01-24 00:00:00",
          "job_apply_link": "https://www.ziprecruiter.com/c/Clay-Labs/Job/GTM-Engineer-(GTM-Ops)/-in-New-York,NY?jid=95336d9ae6c631e7&utm_campaign=google_jobs_apply&utm_source=google_jobs_apply&utm_medium=organic",
          "job_google_link": "https://www.google.com/search?q=jobs&gl=us&hl=en&udm=8#vhid=vt%3D20/docid%3DR830A5nxXHHXtE6lAAAAAA%3D%3D&vssid=jobs-detail-viewer"
        },
        "pairedItem": {
          "item": 1
        }
      },
      {
        "json": {
          "job_id": "V-1A-W97ae8w9UaqAAAAAA==",
          "job_title": "GTM Engineer (Go-to-Market Systems & Automations)",
          "employer_name": "Atmosphere TV",
          "job_location": "Austin, TX",
          "job_country": "US",
          "job_employment_type": "Full-time",
          "job_is_remote": 0,
          "job_posted_at_datetime_utc": "2026-01-24 00:00:00",
          "job_apply_link": "https://www.indeed.com/viewjob?jk=53455d58b2e9ba3a&utm_campaign=google_jobs_apply&utm_source=google_jobs_apply&utm_medium=organic",
          "job_google_link": "https://www.google.com/search?q=jobs&gl=us&hl=en&udm=8#vhid=vt%3D20/docid%3DV-1A-W97ae8w9UaqAAAAAA%3D%3D&vssid=jobs-detail-viewer"
        },
        "pairedItem": {
          "item": 2
        }
      },
      {
        "json": {
          "job_id": "rbmHK5QorNUTgQ7eAAAAAA==",
          "job_title": "GTM Engineer (Sales Assist)",
          "employer_name": "Clay Labs",
          "job_location": "New York, NY",
          "job_country": "US",
          "job_employment_type": "Full-time",
          "job_is_remote": 0,
          "job_posted_at_datetime_utc": "2026-01-25 00:00:00",
          "job_apply_link": "https://www.ziprecruiter.com/c/Clay-Labs/Job/GTM-Engineer-(Sales-Assist)/-in-New-York,NY?jid=f0fb3ad301bdc89a&utm_campaign=google_jobs_apply&utm_source=google_jobs_apply&utm_medium=organic",
          "job_google_link": "https://www.google.com/search?q=jobs&gl=us&hl=en&udm=8#vhid=vt%3D20/docid%3DrbmHK5QorNUTgQ7eAAAAAA%3D%3D&vssid=jobs-detail-viewer"
        },
        "pairedItem": {
          "item": 3
        }
      },
      {
        "json": {
          "job_id": "sf9rpDaIWFJlG4XwAAAAAA==",
          "job_title": "Clay GTM Engineer for Campaigns",
          "employer_name": "Upwork",
          "job_location": "United States",
          "job_country": "US",
          "job_employment_type": "Contractor",
          "job_is_remote": 1,
          "job_posted_at_datetime_utc": "2026-01-21 00:00:00",
          "job_apply_link": "https://www.upwork.com/freelance-jobs/apply/Clay-GTM-Engineer-for-Campaigns_~022013672267281767225/?utm_campaign=google_jobs_apply&utm_source=google_jobs_apply&utm_medium=organic",
          "job_google_link": "https://www.google.com/search?q=jobs&gl=us&hl=en&udm=8#vhid=vt%3D20/docid%3Dsf9rpDaIWFJlG4XwAAAAAA%3D%3D&vssid=jobs-detail-viewer"
        },
        "pairedItem": {
          "item": 4
        }
      },
      {
        "json": {
          "job_id": "XKUikkQaN2FAkS1XAAAAAA==",
          "job_title": "GTM Engineer",
          "employer_name": "Loop AI",
          "job_location": "Tampa, FL",
          "job_country": "US",
          "job_employment_type": "Full-time",
          "job_is_remote": 0,
          "job_posted_at_datetime_utc": "2026-01-22 00:00:00",
          "job_apply_link": "https://www.ziprecruiter.com/c/Loop-AI/Job/GTM-Engineer/-in-Tampa,FL?jid=6341d8d817dcd6c6&utm_campaign=google_jobs_apply&utm_source=google_jobs_apply&utm_medium=organic",
          "job_google_link": "https://www.google.com/search?q=jobs&gl=us&hl=en&udm=8#vhid=vt%3D20/docid%3DXKUikkQaN2FAkS1XAAAAAA%3D%3D&vssid=jobs-detail-viewer"
        },
        "pairedItem": {
          "item": 5
        }
      },
      {
        "json": {
          "job_id": "3ihySSy9Dj7QHmZoAAAAAA==",
          "job_title": "Marketing Operations and GTM Engineer",
          "employer_name": "Level AI",
          "job_location": "Charleston, WV",
          "job_country": "US",
          "job_employment_type": "Full-time",
          "job_is_remote": 0,
          "job_posted_at_datetime_utc": "2026-01-24 00:00:00",
          "job_apply_link": "https://www.ziprecruiter.com/c/Level-AI/Job/Marketing-Operations-and-GTM-Engineer/-in-Remote,US?jid=5b42201cece05a2e&utm_campaign=google_jobs_apply&utm_source=google_jobs_apply&utm_medium=organic",
          "job_google_link": "https://www.google.com/search?q=jobs&gl=us&hl=en&udm=8#vhid=vt%3D20/docid%3D3ihySSy9Dj7QHmZoAAAAAA%3D%3D&vssid=jobs-detail-viewer"
        },
        "pairedItem": {
          "item": 6
        }
      },
      {
        "json": {
          "job_id": "qxhtynYFNL_REc2FAAAAAA==",
          "job_title": "GTM Engineer",
          "employer_name": "Qualia",
          "job_location": "Texas",
          "job_country": "US",
          "job_employment_type": "Full-time",
          "job_is_remote": 0,
          "job_posted_at_datetime_utc": "2026-01-21 00:00:00",
          "job_apply_link": "https://www.engineeringjobs.net/jobdetails.cfm/292748/GTM-Engineer?utm_campaign=google_jobs_apply&utm_source=google_jobs_apply&utm_medium=organic",
          "job_google_link": "https://www.google.com/search?q=jobs&gl=us&hl=en&udm=8#vhid=vt%3D20/docid%3DqxhtynYFNL_REc2FAAAAAA%3D%3D&vssid=jobs-detail-viewer"
        },
        "pairedItem": {
          "item": 7
        }
      },
      {
        "json": {
          "job_id": "5a9YwH6X6rXgjwO2AAAAAA==",
          "job_title": "Founding GTM/Ops Lead (GTM Engineer) - Full-time",
          "employer_name": "EQL Tech",
          "job_location": "Austin, TX",
          "job_country": "US",
          "job_employment_type": "Full-time",
          "job_is_remote": 0,
          "job_posted_at_datetime_utc": "2026-01-23 00:00:00",
          "job_apply_link": "https://www.snagajob.com/jobs/1159717279?utm_campaign=google_jobs_apply&utm_source=google_jobs_apply&utm_medium=organic",
          "job_google_link": "https://www.google.com/search?q=jobs&gl=us&hl=en&udm=8#vhid=vt%3D20/docid%3D5a9YwH6X6rXgjwO2AAAAAA%3D%3D&vssid=jobs-detail-viewer"
        },
        "pairedItem": {
          "item": 8
        }
      },
      {
        "json": {
          "job_id": "0AD7Usl-D-FnrtcgAAAAAA==",
          "job_title": "GTM Automation Engineer â€” Outbound & AI Email",
          "employer_name": "Wing Assistant",
          "job_location": "Jamestown, NY",
          "job_country": "US",
          "job_employment_type": "Full-time",
          "job_is_remote": 0,
          "job_posted_at_datetime_utc": "2026-01-22 00:00:00",
          "job_apply_link": "https://www.learn4good.com/jobs/jamestown/new-york/manufacturing/4804878837/e/?utm_campaign=google_jobs_apply&utm_source=google_jobs_apply&utm_medium=organic",
          "job_google_link": "https://www.google.com/search?q=jobs&gl=us&hl=en&udm=8#vhid=vt%3D20/docid%3D0AD7Usl-D-FnrtcgAAAAAA%3D%3D&vssid=jobs-detail-viewer"
        },
        "pairedItem": {
          "item": 9
        }
      }
    ],
    "Job Scraper2": [
      {
        "json": {
          "status": "OK",
          "request_id": "3a23edcc-7811-4537-bf1c-c245c468dc92",
          "parameters": {
            "query": "Clay & GTM Engineer & Go-to-market jobs in UK",
            "page": 1,
            "num_pages": 1,
            "date_posted": "week",
            "employment_types": [
              "FULLTIME",
              "CONTRACTOR",
              "PARTTIME",
              "INTERN"
            ],
            "country": "us",
            "language": "en"
          },
          "data": []
        },
        "pairedItem": {
          "item": 0
        }
      }
    ]
  },
  "connections": {
    "Jobs UI (GET)": {
      "main": [
        [
          {
            "node": "Fetch Jobs for UI (MySQL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Jobs for UI (MySQL)": {
      "main": [
        [
          {
            "node": "Build Jobs UI HTML (Server)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Jobs UI HTML (Server)": {
      "main": [
        [
          {
            "node": "Jobs UI Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Jobs UI Data (GET)": {
      "main": [
        [
          {
            "node": "Build Jobs Data Query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Jobs Data Query": {
      "main": [
        [
          {
            "node": "Fetch Jobs Data (MySQL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Jobs Data (MySQL)": {
      "main": [
        [
          {
            "node": "Build Jobs Data Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Jobs Data Response": {
      "main": [
        [
          {
            "node": "Jobs Data Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Jobs UI Submit (POST)": {
      "main": [
        [
          {
            "node": "Build Submit Query",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Submit Query": {
      "main": [
        [
          {
            "node": "Fetch Selected Jobs (MySQL)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Selected Jobs (MySQL)": {
      "main": [
        [
          {
            "node": "Filter Selected Jobs (Submit)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Selected Jobs (Submit)": {
      "main": [
        [
          {
            "node": "Selection Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "Job Scraper2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Daily Schedule (9AM EST)2": {
      "main": [
        [
          {
            "node": "Job Scraper2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Job Scraper2": {
      "main": [
        [
          {
            "node": "Split Out2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Alert - Job Scraper",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out2": {
      "main": [
        [
          {
            "node": "Prepare Job Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Job Data": {
      "main": [
        [
          {
            "node": "MySQL Insert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "f9db3a3b-60bd-4866-8e50-acdfbbd40757",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "238e209ef863af056f51ef319ce60e54301f4959b4ddfd37a8126b18abdcba6f"
  },
  "id": "5QsHJIgQ6hrule__9bbtK",
  "tags": []
}